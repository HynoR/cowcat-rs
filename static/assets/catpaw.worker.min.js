"use strict";let wasmInstancePromise;async function loadWasm(){return wasmInstancePromise||(wasmInstancePromise=(async()=>{const n="/__cowcatwaf/assets/catpaw.wasm",e={};if(typeof WebAssembly.instantiateStreaming=="function")try{const{instance:o}=await WebAssembly.instantiateStreaming(fetch(n),e);return o}catch{const i=await(await fetch(n)).arrayBuffer(),{instance:f}=await WebAssembly.instantiate(i,e);return f}const c=await(await fetch(n)).arrayBuffer(),{instance:s}=await WebAssembly.instantiate(c,e);return s})(),wasmInstancePromise)}function clampU32(n){return!Number.isFinite(n)||n<0?0:n>>>0}function hasLeadingZeroBits(n,e){if(e===0)return!0;let t=e;for(const c of n){if(t<=0)return!0;const s=Math.clz32(c)-24;if(s>=t)return!0;if(s!==8)return!1;t-=8}return t<=0}async function powSearchNative(n,e,t,c,s){if(typeof crypto>"u"||!crypto.subtle||typeof crypto.subtle.digest!="function")throw new Error("WebCrypto unavailable");const o=new TextEncoder,u=1e3;let i=0,f=t;const r=s===0?Number.MAX_SAFE_INTEGER:s;for(;i<r;){const g=r-i,a=Math.min(u,g);for(let l=0;l<a;l++){const b=o.encode(n+String(f)),w=await crypto.subtle.digest("SHA-256",b);if(hasLeadingZeroBits(new Uint8Array(w),e))return{found:!0,nonce:f>>>0};f=f+c>>>0}i+=a,self.postMessage({type:"progress",hashes:a})}return{found:!1}}self.onmessage=async n=>{try{const e=n.data||{},t=e.prefix,c=clampU32(e.bits),s=clampU32(e.start),o=clampU32(e.step),u=clampU32(e.max_iters),i=String(e.worker_type||"").trim().toLowerCase();if(typeof t!="string"||t.length===0)throw new Error("Invalid prefix");if(o===0)throw new Error("Invalid step");if(i==="native"){const p=await powSearchNative(t,c,s,o,u);if(p.found){self.postMessage({nonce:String(p.nonce)});return}throw new Error("Nonce not found")}const r=(await loadWasm()).exports;if(!r||typeof r.pow_search!="function"||typeof r.alloc!="function"||typeof r.dealloc!="function")throw new Error("Invalid WASM exports");const a=new TextEncoder().encode(t),l=r.alloc(a.length);new Uint8Array(r.memory.buffer,l,a.length).set(a);const w=1e5;let m=0,h=s,d=!1,A=0;for(;m<u&&!d;){const p=u-m,y=Math.min(w,p),S=r.pow_search(l,a.length,c,h,o,y);if(m+=y,self.postMessage({type:"progress",hashes:y}),S>>>0!==4294967295){d=!0,A=S;break}h=h+o*y>>>0}if(r.dealloc(l,a.length),d)self.postMessage({nonce:String(A>>>0)});else throw new Error("Nonce not found")}catch(e){const t={error:e&&e.message?e.message:String(e),errorType:e&&e.name?e.name:"UnknownError",errorStack:e&&e.stack?e.stack:"",workerInfo:{hasTextEncoder:typeof TextEncoder<"u",hasWebAssembly:typeof WebAssembly<"u",hasWebAssemblyInstantiateStreaming:typeof WebAssembly<"u"&&typeof WebAssembly.instantiateStreaming=="function",userAgent:typeof navigator<"u"?navigator.userAgent:"unknown"}};self.postMessage(t)}};
